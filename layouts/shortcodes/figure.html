<!--
  Acquired and adjusted from https://github.com/liwenyip/hugo-easy-gallery/
  Documentation and license located there
-->

{{- $thumb := .Get "src" | default (printf "%s." (.Get "thumb") | replace (.Get "link") ".") }}

<div class="lightbox">
  <figure
    itemprop="associatedMedia"
    itemscope
    itemtype="http://schema.org/ImageObject"

    class="
      {{ with .Get "float" }}
        figure-{{ . }}
      {{ end }}

      {{ if .Get "nophotoswipe" }}
        no-photoswipe
      {{ end }}
    "

    style="
      {{ with .Get "width" }}
        max-width: {{ . }};
      {{ end }}

      {{ if .Parent }}
        background-image: url({{ $thumb }});
      {{ end }}
    "
  >

    <img
      itemprop="thumbnail"
      src="{{ $thumb }}"

      {{ with .Get "alt" | default (.Get "caption") }}
        alt="{{ . }}"
      {{ end }}
    />

    <a
      {{ with .Get "link" | default (.Get "src") }}
        href="{{ . }}"
      {{ end }}

      {{ with .Get "size" }}
        data-size="{{ . }}"
      {{ end }}

      itemprop="contentUrl"
    ></a>

    {{- if or (.Get "caption") (.Get "attr")}}
      <figcaption>
          <p>
            {{- .Get "caption" -}}

            {{- with .Get "attrlink"}}
              <a href="{{ . }}">{{ .Get "attr" }}</a>
            {{ else }}
              {{ .Get "attr"}}
            {{ end -}}
          </p>
      </figcaption>
    {{- end }}
  </figure>
</div>
